

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Kaggle - Predicting Bike Sharing Demand &#8212; Anindya&#39;s Blog</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-dropdown.css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Clustering Uber’s Trip Data with Apache Spark" href="../../data-science-with-spark/cluster-uber-trip-data/cluster-uber-trip-data.html" />
    <link rel="prev" title="Classification: Predict Diagnosis of a Breast Tumor as Malignant or Benign" href="../breast-cancer-risk-prediction-classification/breast-cancer-risk-prediction-classification.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">



  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../../index.html">
  
  <img src="../../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">Anindya's Blog</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../intro.html">
   Welcome to your Jupyter Book
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Machine Learning With Python
 </span>
</p>
<ul class="current nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../breast-cancer-risk-prediction-classification/breast-cancer-risk-prediction-classification.html">
   Classification: Predict Diagnosis of a Breast Tumor as Malignant or Benign
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Kaggle - Predicting Bike Sharing Demand
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Data Science with Spark
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../data-science-with-spark/cluster-uber-trip-data/cluster-uber-trip-data.html">
   Clustering Uber’s Trip Data with Apache Spark
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../data-science-with-spark/retail-database-analysis-python/retail-database-analysis-python.html">
   Advanced Data Analysis of a Retail Store using Apache Spark (PySpark)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Leetcode Solutions
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../../leetcode/lc5455.html">
   5455. Minimum Number of Days to Make m Bouquets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../leetcode/lc5455.html#solution">
   Solution
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../leetcode/lc5456.html">
   5456. Kth Ancestor of a Tree Node
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/machine-learning-with-python/kaggle-bike-sharing-demand/kaggle-bike-sharing-demand.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hypothesis-generation">
   1. Hypothesis Generation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#understanding-the-data-set">
   2. Understanding the Data Set
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#importing-data-set-and-basic-data-exploration">
   3. Importing Data Set and Basic Data Exploration
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#combine-both-train-and-test-data-set-to-understand-the-distribution-of-independent-variable-together">
     3.1. Combine both Train and Test Data set (to understand the distribution of independent variable together).
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#understand-the-distribution-of-numerical-variables-and-generate-a-frequency-table-for-numeric-variables">
     3.2. Understand the distribution of numerical variables and generate a frequency table for numeric variables.
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#hypothesis-testing-using-multivariate-analysis">
   4. Hypothesis Testing (using multivariate analysis)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#good-weather-is-most-frequent-in-fall-sup-5-sup">
     Good Weather is most frequent in Fall
     <sup>
      [5]
     </sup>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#normal-weather-happens-most-frequent-in-spring-sup-5-sup">
     Normal Weather happens most frequent in Spring
     <sup>
      [5]
     </sup>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bad-weather-happens-most-frequent-in-summer-winter-sup-5-sup">
     Bad Weather happens most frequent in Summer &amp; Winter
     <sup>
      [5]
     </sup>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bikes-are-rented-more-in-good-weather-and-much-less-in-bad-weather">
     Bikes are rented more in Good Weather and much less in Bad Weather
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bikes-are-rented-more-in-fall-and-much-less-in-spring">
     Bikes are rented more in Fall and much less in Spring
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#bikes-are-rented-mostly-for-morning-evening-commutes-on-weekdays-and-mostly-daytime-rides-on-weekends">
     Bikes are rented mostly for Morning/Evening commutes on Weekdays, and mostly Daytime rides on Weekends
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#renting-patterns-of-bikes-are-significantly-different-between-registered-and-casual-users">
     Renting patterns of Bikes are significantly different between Registered and Casual Users
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#on-workdays-most-bikes-are-rented-on-warm-mornings-and-evenings-sup-2-sup">
     On Workdays most Bikes are rented on Warm Mornings and Evenings
     <sup>
      [2]
     </sup>
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correlation-between-count-and-features">
     Correlation Between Count And Features
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribution-of-data-between-train-and-test-set-based-on-season">
     Distribution of data between Train and Test set based on Season
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribution-of-data-between-train-and-test-set-based-on-weather">
     Distribution of data between Train and Test set based on Weather
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#distribution-of-count-of-users-train-and-test-set-based-on-year">
     Distribution of count of users Train and Test set based on Year
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#feature-engineering">
   5. Feature Engineering
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#training-models">
   6. Training Models
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stacking">
   7. Stacking
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manual-stacking">
     7.1 Manual Stacking
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stacking-with-linear-regression">
     7.1 Stacking  with Linear Regression
    </a>
   </li>
  </ul>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="kaggle-predicting-bike-sharing-demand">
<h1>Kaggle - Predicting Bike Sharing Demand<a class="headerlink" href="#kaggle-predicting-bike-sharing-demand" title="Permalink to this headline">¶</a></h1>
<p><strong>Problem Statement</strong></p>
<p>Bike sharing systems are a means of renting bicycles where the process of obtaining membership, rental, and bike return is automated via a network of kiosk locations throughout a city. Using these Bike Sharing systems, people rent a bike from one location and return it to a different or same place on need basis. People can rent a bike through membership (mostly regular users) or on demand basis (mostly casual users). This process is controlled by a network of automated kiosk across the city.</p>
<p><img alt="bike sharing" src="../../_images/bikes.png" /></p>
<p>In <a class="reference external" href="https://www.kaggle.com/c/bike-sharing-demand">Kaggle Bike Sharing Demand</a>, the participants were asked to forecast bike rental demand of Bike sharing program in Washington, D.C. based on historical usage patterns in relation with weather, time and other data.</p>
<p><strong>Evaluation</strong></p>
<p>Submissions are evaluated one the Root Mean Squared Logarithmic Error (RMSLE). The RMSLE is calculated as</p>
<div class="math notranslate nohighlight">
\[\sqrt{\frac{1}{n}\sum_{i=1}^n (log(p_i + 1) - log(a_i + 1))^2}\]</div>
<p>where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(n\)</span> is the number of hours in the test set</p></li>
<li><p><span class="math notranslate nohighlight">\(p_i\)</span> is your predicted count</p></li>
<li><p><span class="math notranslate nohighlight">\(a_i\)</span> is the actual count</p></li>
<li><p>log(x) is the natural logarithm</p></li>
</ul>
<p>I have compiled this notebook by collating theory and codes from other blogs as well along with my own implementations. Wherever I have copied the theory/codes verbatim I have highlighted the references with <sup>[1]</sup> to give the authors their due credit. Please refer to the reference section at the end of the notebook for the original blogs of the respective authors.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestRegressor</span><span class="p">,</span> <span class="n">GradientBoostingRegressor</span>

<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.core.interactiveshell</span> <span class="kn">import</span> <span class="n">InteractiveShell</span>
<span class="n">InteractiveShell</span><span class="o">.</span><span class="n">ast_node_interactivity</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s1">&#39;display.max_colwidth&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="c1">#sns.set_style(&quot;whitegrid&quot;)</span>
<span class="c1">#plt.style.use(&#39;bmh&#39;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;seaborn-whitegrid&#39;</span><span class="p">)</span>

<span class="c1"># this allows plots to appear directly in the notebook</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="o">%</span><span class="n">config</span> <span class="n">InlineBackend</span><span class="o">.</span><span class="n">figure_format</span> <span class="o">=</span> <span class="s1">&#39;retina&#39;</span>
</pre></div>
</div>
<div class="section" id="hypothesis-generation">
<h2>1. Hypothesis Generation<a class="headerlink" href="#hypothesis-generation" title="Permalink to this headline">¶</a></h2>
<p>Before exploring the data to understand the relationship between variables, it is recommended that we focus on hypothesis generation first. Now, this might sound counter-intuitive for solving a data science problem, but before exploring data, we should spend some time thinking about the business problem, gaining the domain knowledge and may be gaining first hand experience of the problem.</p>
<p>How does it help? This practice usually helps us form better features later on, which are not biased by the data available in the dataset. At this stage, we are expected to posses structured thinking i.e. a thinking process which takes into consideration all the possible aspects of a particular problem.</p>
<p>Here are some of the hypothesis which could influence the demand of bikes:</p>
<p><strong>Hourly trend:</strong> There must be high demand during office timings. Early morning and late evening can have different trend (cyclist) and low demand during 10:00 pm to 4:00 am.</p>
<p><strong>Daily Trend:</strong> Registered users demand more bike on weekdays as compared to weekend or holiday.</p>
<p><strong>Rain:</strong> The demand of bikes will be lower on a rainy day as compared to a sunny day. Similarly, higher humidity will cause to lower the demand and vice versa.</p>
<p><strong>Temperature:</strong> In India, temperature has negative correlation with bike demand. But, after looking at Washington’s temperature graph, we presume it may have positive correlation.</p>
<p><strong>Pollution:</strong> If the pollution level in a city starts soaring, people may start using Bike (it may be influenced by government / company policies or increased awareness).</p>
<p><strong>Time:</strong> Total demand should have higher contribution of registered user as compared to casual because registered user base would increase over time.</p>
<p><strong>Traffic:</strong> It can be positively correlated with Bike demand. Higher traffic may force people to use bike as compared to other road transport medium like car, taxi etc.</p>
</div>
<div class="section" id="understanding-the-data-set">
<h2>2. Understanding the Data Set<a class="headerlink" href="#understanding-the-data-set" title="Permalink to this headline">¶</a></h2>
<p>The dataset shows hourly rental data for two years (2011 and 2012). The training data set is for the first 19 days of each month. The test dataset is from 20th day to month’s end. We are required to predict the total count of bikes rented during each hour covered by the test set.</p>
<p>In the training data set, they have separately given bike demand by registered, casual users and sum of both is given as count.</p>
<p>Training data set has 12 variables (see below) and Test has 9 (excluding registered, casual and count).</p>
<p style="text-align: justify;"><strong>Independent Variables</strong></p>
<pre><strong>datetime:   </strong>date and hour in "mm/dd/yyyy hh:mm" format
<strong>season:</strong> &nbsp;   Four categories-&gt; 1 = spring, 2 = summer, 3 = fall, 4 = winter
<strong>holiday:</strong>    whether the day is a holiday or not (1/0)
<strong>workingday:</strong> whether the day is neither a weekend nor holiday (1/0)
<strong>weather:</strong>&nbsp;   Four Categories of weather
            1-&gt; Clear, Few clouds, Partly cloudy
            2-&gt; Mist + Cloudy, Mist + Broken clouds, Mist + Few clouds, Mist
            3-&gt; Light Snow and Rain + Thunderstorm + Scattered clouds, Light Rain + Scattered clouds
            4-&gt; Heavy Rain + Ice Pallets + Thunderstorm + Mist, Snow + Fog
<strong>temp:</strong>       hourly temperature in Celsius
<strong>atemp:</strong>      "feels like" temperature in Celsius
<strong>humidity:</strong>   relative humidity
<strong>windspeed:</strong>  wind speed
</pre>
<p><strong>Dependent Variables</strong></p>
<pre><strong>registered:</strong> number of registered user
<strong>casual:</strong>     number of non-registered user
<strong>count:</strong>      number of total rentals (registered + casual)
</pre> 
</div>
<div class="section" id="importing-data-set-and-basic-data-exploration">
<h2>3. Importing Data Set and Basic Data Exploration<a class="headerlink" href="#importing-data-set-and-basic-data-exploration" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/train.csv&#39;</span><span class="p">)</span>
<span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;data_set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;train&#39;</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
    .dataframe thead th {
        text-align: left;
    }
    .dataframe tbody tr th {
        vertical-align: top;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>casual</th>
      <th>registered</th>
      <th>count</th>
      <th>data_set</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-01-01 00:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>81</td>
      <td>0.0</td>
      <td>3</td>
      <td>13</td>
      <td>16</td>
      <td>train</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-01-01 01:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>8</td>
      <td>32</td>
      <td>40</td>
      <td>train</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-01-01 02:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.02</td>
      <td>13.635</td>
      <td>80</td>
      <td>0.0</td>
      <td>5</td>
      <td>27</td>
      <td>32</td>
      <td>train</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-01-01 03:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>3</td>
      <td>10</td>
      <td>13</td>
      <td>train</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-01-01 04:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9.84</td>
      <td>14.395</td>
      <td>75</td>
      <td>0.0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>train</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/test.csv&#39;</span><span class="p">)</span>
<span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;data_set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span>
<span class="n">test_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>season</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>data_set</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2011-01-20 00:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>11.365</td>
      <td>56</td>
      <td>26.0027</td>
      <td>test</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2011-01-20 01:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>13.635</td>
      <td>56</td>
      <td>0.0000</td>
      <td>test</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2011-01-20 02:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>13.635</td>
      <td>56</td>
      <td>0.0000</td>
      <td>test</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2011-01-20 03:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>12.880</td>
      <td>56</td>
      <td>11.0014</td>
      <td>test</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2011-01-20 04:00:00</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>10.66</td>
      <td>12.880</td>
      <td>56</td>
      <td>11.0014</td>
      <td>test</td>
    </tr>
  </tbody>
</table>
</div>
<div class="section" id="combine-both-train-and-test-data-set-to-understand-the-distribution-of-independent-variable-together">
<h3>3.1. Combine both Train and Test Data set (to understand the distribution of independent variable together).<a class="headerlink" href="#combine-both-train-and-test-data-set-to-understand-the-distribution-of-independent-variable-together" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># combine train and test data into one df</span>
<span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;registered&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;casual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">test_df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">all_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span><span class="p">])</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>atemp</th>
      <th>casual</th>
      <th>count</th>
      <th>data_set</th>
      <th>datetime</th>
      <th>holiday</th>
      <th>humidity</th>
      <th>registered</th>
      <th>season</th>
      <th>temp</th>
      <th>weather</th>
      <th>windspeed</th>
      <th>workingday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>14.395</td>
      <td>3</td>
      <td>16</td>
      <td>train</td>
      <td>2011-01-01 00:00:00</td>
      <td>0</td>
      <td>81</td>
      <td>13</td>
      <td>1</td>
      <td>9.84</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>13.635</td>
      <td>8</td>
      <td>40</td>
      <td>train</td>
      <td>2011-01-01 01:00:00</td>
      <td>0</td>
      <td>80</td>
      <td>32</td>
      <td>1</td>
      <td>9.02</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>13.635</td>
      <td>5</td>
      <td>32</td>
      <td>train</td>
      <td>2011-01-01 02:00:00</td>
      <td>0</td>
      <td>80</td>
      <td>27</td>
      <td>1</td>
      <td>9.02</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>14.395</td>
      <td>3</td>
      <td>13</td>
      <td>train</td>
      <td>2011-01-01 03:00:00</td>
      <td>0</td>
      <td>75</td>
      <td>10</td>
      <td>1</td>
      <td>9.84</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>14.395</td>
      <td>0</td>
      <td>1</td>
      <td>train</td>
      <td>2011-01-01 04:00:00</td>
      <td>0</td>
      <td>75</td>
      <td>1</td>
      <td>1</td>
      <td>9.84</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">all_df</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>atemp</th>
      <th>casual</th>
      <th>count</th>
      <th>data_set</th>
      <th>datetime</th>
      <th>holiday</th>
      <th>humidity</th>
      <th>registered</th>
      <th>season</th>
      <th>temp</th>
      <th>weather</th>
      <th>windspeed</th>
      <th>workingday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>6488</th>
      <td>12.880</td>
      <td>0</td>
      <td>0</td>
      <td>test</td>
      <td>2012-12-31 19:00:00</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>1</td>
      <td>10.66</td>
      <td>2</td>
      <td>11.0014</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6489</th>
      <td>12.880</td>
      <td>0</td>
      <td>0</td>
      <td>test</td>
      <td>2012-12-31 20:00:00</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>1</td>
      <td>10.66</td>
      <td>2</td>
      <td>11.0014</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6490</th>
      <td>12.880</td>
      <td>0</td>
      <td>0</td>
      <td>test</td>
      <td>2012-12-31 21:00:00</td>
      <td>0</td>
      <td>60</td>
      <td>0</td>
      <td>1</td>
      <td>10.66</td>
      <td>1</td>
      <td>11.0014</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6491</th>
      <td>13.635</td>
      <td>0</td>
      <td>0</td>
      <td>test</td>
      <td>2012-12-31 22:00:00</td>
      <td>0</td>
      <td>56</td>
      <td>0</td>
      <td>1</td>
      <td>10.66</td>
      <td>1</td>
      <td>8.9981</td>
      <td>1</td>
    </tr>
    <tr>
      <th>6492</th>
      <td>13.635</td>
      <td>0</td>
      <td>0</td>
      <td>test</td>
      <td>2012-12-31 23:00:00</td>
      <td>0</td>
      <td>65</td>
      <td>0</td>
      <td>1</td>
      <td>10.66</td>
      <td>1</td>
      <td>8.9981</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># lowercase column names</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">,</span> <span class="n">all_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Index([&#39;atemp&#39;, &#39;casual&#39;, &#39;count&#39;, &#39;data_set&#39;, &#39;datetime&#39;, &#39;holiday&#39;,
       &#39;humidity&#39;, &#39;registered&#39;, &#39;season&#39;, &#39;temp&#39;, &#39;weather&#39;, &#39;windspeed&#39;,
       &#39;workingday&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># parse datetime colum &amp; add new time related columns</span>
<span class="n">dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">(</span><span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">])</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">dt</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">all_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>atemp</th>
      <th>casual</th>
      <th>count</th>
      <th>data_set</th>
      <th>datetime</th>
      <th>holiday</th>
      <th>humidity</th>
      <th>registered</th>
      <th>season</th>
      <th>temp</th>
      <th>weather</th>
      <th>windspeed</th>
      <th>workingday</th>
    </tr>
    <tr>
      <th>datetime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01 00:00:00</th>
      <td>14.395</td>
      <td>3</td>
      <td>16</td>
      <td>train</td>
      <td>2011-01-01 00:00:00</td>
      <td>0</td>
      <td>81</td>
      <td>13</td>
      <td>1</td>
      <td>9.84</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2011-01-01 01:00:00</th>
      <td>13.635</td>
      <td>8</td>
      <td>40</td>
      <td>train</td>
      <td>2011-01-01 01:00:00</td>
      <td>0</td>
      <td>80</td>
      <td>32</td>
      <td>1</td>
      <td>9.02</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2011-01-01 02:00:00</th>
      <td>13.635</td>
      <td>5</td>
      <td>32</td>
      <td>train</td>
      <td>2011-01-01 02:00:00</td>
      <td>0</td>
      <td>80</td>
      <td>27</td>
      <td>1</td>
      <td>9.02</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2011-01-01 03:00:00</th>
      <td>14.395</td>
      <td>3</td>
      <td>13</td>
      <td>train</td>
      <td>2011-01-01 03:00:00</td>
      <td>0</td>
      <td>75</td>
      <td>10</td>
      <td>1</td>
      <td>9.84</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2011-01-01 04:00:00</th>
      <td>14.395</td>
      <td>0</td>
      <td>1</td>
      <td>train</td>
      <td>2011-01-01 04:00:00</td>
      <td>0</td>
      <td>75</td>
      <td>1</td>
      <td>1</td>
      <td>9.84</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Indexing by datetime let&#39;s us to select rows by specifying time ranges</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;2011-01-01 01:00:00&#39;</span><span class="p">:</span><span class="s1">&#39;2011-01-01 03:00:00&#39;</span><span class="p">]</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>atemp</th>
      <th>casual</th>
      <th>count</th>
      <th>data_set</th>
      <th>datetime</th>
      <th>holiday</th>
      <th>humidity</th>
      <th>registered</th>
      <th>season</th>
      <th>temp</th>
      <th>weather</th>
      <th>windspeed</th>
      <th>workingday</th>
    </tr>
    <tr>
      <th>datetime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01 01:00:00</th>
      <td>13.635</td>
      <td>8</td>
      <td>40</td>
      <td>train</td>
      <td>2011-01-01 01:00:00</td>
      <td>0</td>
      <td>80</td>
      <td>32</td>
      <td>1</td>
      <td>9.02</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2011-01-01 02:00:00</th>
      <td>13.635</td>
      <td>5</td>
      <td>32</td>
      <td>train</td>
      <td>2011-01-01 02:00:00</td>
      <td>0</td>
      <td>80</td>
      <td>27</td>
      <td>1</td>
      <td>9.02</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2011-01-01 03:00:00</th>
      <td>14.395</td>
      <td>3</td>
      <td>13</td>
      <td>train</td>
      <td>2011-01-01 03:00:00</td>
      <td>0</td>
      <td>75</td>
      <td>10</td>
      <td>1</td>
      <td>9.84</td>
      <td>1</td>
      <td>0.0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># find missing values in dataset if any</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
<div class="section" id="understand-the-distribution-of-numerical-variables-and-generate-a-frequency-table-for-numeric-variables">
<h3>3.2. Understand the distribution of numerical variables and generate a frequency table for numeric variables.<a class="headerlink" href="#understand-the-distribution-of-numerical-variables-and-generate-a-frequency-table-for-numeric-variables" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">421</span><span class="p">)</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Histogram of Season&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">422</span><span class="p">)</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;weather&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Histogram of Weather&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">423</span><span class="p">)</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;humidity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Histogram of Humidity&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">424</span><span class="p">)</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;holiday&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;pink&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Histogram of Holiday&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">425</span><span class="p">)</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;workingday&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Histogram of Working Day&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">426</span><span class="p">)</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;yellow&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Histogram of Temperature&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">427</span><span class="p">)</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;atemp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Histogram of Feels Like Temp&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">428</span><span class="p">)</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;windspeed&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Histogram of Windpseed&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_17_0.png" /></p>
<p>Few inferences can be drawn by looking at the these histograms:</p>
<ul class="simple">
<li><p>Season has four categories of almost equal distribution</p></li>
<li><p>Weather 1 has higher contribution i.e. mostly clear weather.</p></li>
<li><p>As expected, mostly working days and variable holiday is also showing a similar inference. You can use the code above to look at the distribution in detail. Here you can generate a variable for weekday using holiday and working day. Incase, if both have zero values, then it must be a working day.</p></li>
<li><p>Variables temp, atemp, humidity and windspeed  looks naturally distributed.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># logarithmic transformation of dependent cols</span>
<span class="c1"># (adding 1 first so that 0 values don&#39;t become -inf)</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;casual&#39;</span><span class="p">,</span> <span class="s1">&#39;registered&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]:</span>
    <span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_log&#39;</span> <span class="o">%</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">all_df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">date</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">day</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">month</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">hour</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;dow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">dayofweek</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;woy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">weekofyear</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># How many columns have null values</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>atemp             0
casual            0
count             0
data_set          0
datetime          0
holiday           0
humidity          0
registered        0
season            0
temp              0
weather           0
windspeed         0
workingday        0
casual_log        0
registered_log    0
count_log         0
date              0
day               0
month             0
year              0
hour              0
dow               0
woy               0
dtype: int64
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># interpolate weather, temp, atemp, humidity, windspeed</span>
<span class="n">all_df</span><span class="p">[</span><span class="s2">&quot;weather&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[</span><span class="s2">&quot;weather&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">)</span>
<span class="n">all_df</span><span class="p">[</span><span class="s2">&quot;temp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[</span><span class="s2">&quot;temp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">all_df</span><span class="p">[</span><span class="s2">&quot;atemp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[</span><span class="s2">&quot;atemp&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
<span class="n">all_df</span><span class="p">[</span><span class="s2">&quot;humidity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[</span><span class="s2">&quot;humidity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">)</span>
<span class="n">all_df</span><span class="p">[</span><span class="s2">&quot;windspeed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[</span><span class="s2">&quot;windspeed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># add a count_season column using join</span>
<span class="n">by_season</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[</span><span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;data_set&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;season&#39;</span><span class="p">])[[</span><span class="s1">&#39;count&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="nb">sum</span><span class="p">)</span>
<span class="n">by_season</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;count_season&#39;</span><span class="p">]</span>
<span class="n">all_df</span> <span class="o">=</span> <span class="n">all_df</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">by_season</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;season&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">by_season</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>        count_season
season              
1             312498
2             588282
3             640662
4             544034
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">by_season</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">();</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_25_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_day</span><span class="p">(</span><span class="n">day_start</span><span class="p">):</span>
    <span class="n">day_end</span> <span class="o">=</span> <span class="n">day_start</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">offsets</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">23</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">day_start</span><span class="p">,</span> <span class="n">day_end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;H&quot;</span><span class="p">)</span>

<span class="c1"># tax day</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">get_day</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">)),</span> <span class="s2">&quot;workingday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">get_day</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">)),</span> <span class="s2">&quot;workingday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># thanksgiving friday</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">get_day</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">25</span><span class="p">)),</span> <span class="s2">&quot;workingday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">get_day</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">23</span><span class="p">)),</span> <span class="s2">&quot;workingday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># tax day</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">get_day</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">15</span><span class="p">)),</span> <span class="s2">&quot;holiday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">get_day</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">16</span><span class="p">)),</span> <span class="s2">&quot;holiday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># thanksgiving friday</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">get_day</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2011</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">25</span><span class="p">)),</span> <span class="s2">&quot;holiday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">get_day</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">23</span><span class="p">)),</span> <span class="s2">&quot;holiday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1">#storms</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">get_day</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">21</span><span class="p">)),</span> <span class="s2">&quot;holiday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1">#tornado</span>
<span class="n">all_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">get_day</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2012</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="s2">&quot;holiday&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">by_hour</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[</span><span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;data_set&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;workingday&#39;</span><span class="p">])[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="s1">&#39;sum&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unstack</span><span class="p">()</span>
<span class="n">by_hour</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>workingday</th>
      <th>0</th>
      <th>1</th>
    </tr>
    <tr>
      <th>hour</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>13633</td>
      <td>11455</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10384</td>
      <td>4988</td>
    </tr>
    <tr>
      <th>2</th>
      <td>7654</td>
      <td>2605</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3666</td>
      <td>1425</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1230</td>
      <td>1602</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1280</td>
      <td>7655</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2719</td>
      <td>31979</td>
    </tr>
    <tr>
      <th>7</th>
      <td>6318</td>
      <td>90650</td>
    </tr>
    <tr>
      <th>8</th>
      <td>15380</td>
      <td>149680</td>
    </tr>
    <tr>
      <th>9</th>
      <td>25324</td>
      <td>75586</td>
    </tr>
  </tbody>
</table>
</div>
<p><strong>Hourly trend:</strong> There must be high demand during office timings. Early morning and late evening can have different trend (cyclist) and low demand during 10:00 pm to 4:00 am.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># rentals by hour, split by working day (or not)</span>
<span class="n">by_hour</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.8</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_29_0.png" /></p>
</div>
</div>
<div class="section" id="hypothesis-testing-using-multivariate-analysis">
<h2>4. Hypothesis Testing (using multivariate analysis)<a class="headerlink" href="#hypothesis-testing-using-multivariate-analysis" title="Permalink to this headline">¶</a></h2>
<p>Till now, we have got a fair understanding of the data set. Now, let’s test the hypothesis which we had generated earlier.  Here we have added some additional hypothesis from the dataset. Let’s test them one by one:</p>
<p><strong>Hourly trend</strong>: We don’t have the variable ‘hour’ as part of data provides but we extracted it using the datetime column.
Let’s plot the hourly trend of count over hours and check if our hypothesis is correct or not. We will separate train and test data set from combined one.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[</span><span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;data_set&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#train_df.boxplot(column=&#39;count&#39;, by=&#39;hour&#39;, figsize=(15,5))</span>
<span class="c1">#plt.ylabel(&#39;Count of Users&#39;)</span>
<span class="c1">#plt.title(&quot;Boxplot of Count grouped by hour&quot;)</span>
<span class="c1">#plt.suptitle(&quot;&quot;) # get rid of the pandas autogenerated title</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Count of Users&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Boxplot of Count grouped by hour&quot;</span><span class="p">);</span>
<span class="c1">#plt.suptitle(&quot;&quot;) # get rid of the pandas autogenerated title</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_33_0.png" /></p>
<p>Above, we can see the trend of bike demand over hours. Quickly, we’ll segregate the bike demand in three categories:</p>
<ul class="simple">
<li><p>High     : 7-9 and 17-19 hours</p></li>
<li><p>Average  : 10-16 hours</p></li>
<li><p>Low      : 0-6 and 20-24 hours
Here we have analyzed the distribution of total bike demand.</p></li>
</ul>
<p>Let’s look at the distribution of registered and casual users separately.</p>
<div class="section" id="good-weather-is-most-frequent-in-fall-sup-5-sup">
<h3>Good Weather is most frequent in Fall<sup>[5]</sup><a class="headerlink" href="#good-weather-is-most-frequent-in-fall-sup-5-sup" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">season_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Spring&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Summer&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Fall&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Winter&#39;</span><span class="p">}</span>
<span class="n">good_weather</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[</span><span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;weather&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">][[</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;count&#39;</span> <span class="p">:</span> <span class="n">good_weather</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span> <span class="p">:</span> <span class="n">season_map</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Hour Of The Day&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Good Weather Count&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Good Weather By Hour Of The Day Across Season&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_36_01.png" /></p>
</div>
<div class="section" id="normal-weather-happens-most-frequent-in-spring-sup-5-sup">
<h3>Normal Weather happens most frequent in Spring<sup>[5]</sup><a class="headerlink" href="#normal-weather-happens-most-frequent-in-spring-sup-5-sup" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">season_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Spring&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Summer&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Fall&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Winter&#39;</span><span class="p">}</span>
<span class="n">normal_weather</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[</span><span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;weather&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">][[</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;count&#39;</span> <span class="p">:</span> <span class="n">normal_weather</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span> <span class="p">:</span> <span class="n">season_map</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hour</th>
      <th>season</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>50</th>
      <td>12</td>
      <td>Fall</td>
      <td>12</td>
    </tr>
    <tr>
      <th>46</th>
      <td>11</td>
      <td>Fall</td>
      <td>11</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>Winter</td>
      <td>11</td>
    </tr>
    <tr>
      <th>63</th>
      <td>15</td>
      <td>Winter</td>
      <td>19</td>
    </tr>
    <tr>
      <th>33</th>
      <td>8</td>
      <td>Summer</td>
      <td>18</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Hour Of The Day&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Normal Weather Count&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Normal Weather By Hour Of The Day Across Season&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_40_01.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s1">&#39;hour&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>season</th>
      <th>Fall</th>
      <th>Spring</th>
      <th>Summer</th>
      <th>Winter</th>
    </tr>
    <tr>
      <th>hour</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>18</th>
      <td>14</td>
      <td>18</td>
      <td>19</td>
      <td>18</td>
    </tr>
    <tr>
      <th>4</th>
      <td>8</td>
      <td>14</td>
      <td>19</td>
      <td>16</td>
    </tr>
    <tr>
      <th>15</th>
      <td>15</td>
      <td>16</td>
      <td>16</td>
      <td>19</td>
    </tr>
    <tr>
      <th>12</th>
      <td>12</td>
      <td>12</td>
      <td>14</td>
      <td>17</td>
    </tr>
    <tr>
      <th>11</th>
      <td>11</td>
      <td>11</td>
      <td>8</td>
      <td>17</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">data</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">area</span><span class="p">(</span><span class="n">stacked</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Hour Of The Day&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Normal Weather Count&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Normal Weather By Hour Of The Day Across Season&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_42_0.png" /></p>
</div>
<div class="section" id="bad-weather-happens-most-frequent-in-summer-winter-sup-5-sup">
<h3>Bad Weather happens most frequent in Summer &amp; Winter<sup>[5]</sup><a class="headerlink" href="#bad-weather-happens-most-frequent-in-summer-winter-sup-5-sup" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">season_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Spring&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Summer&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Fall&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Winter&#39;</span><span class="p">}</span>
<span class="n">bad_weather</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[</span><span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;weather&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">][[</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;count&#39;</span> <span class="p">:</span> <span class="n">bad_weather</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">size</span><span class="p">()})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span> <span class="p">:</span> <span class="n">season_map</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Hour Of The Day&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Bad Weather Count&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Bad Weather By Hour Of The Day Across Season&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_44_01.png" /></p>
</div>
<div class="section" id="bikes-are-rented-more-in-good-weather-and-much-less-in-bad-weather">
<h3>Bikes are rented more in Good Weather and much less in Bad Weather<a class="headerlink" href="#bikes-are-rented-more-in-good-weather-and-much-less-in-bad-weather" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">weather_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Good&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Normal&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Bad&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Worse&#39;</span><span class="p">}</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span><span class="s2">&quot;weather&quot;</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;weather&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;weather&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span> <span class="p">:</span> <span class="n">weather_map</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;weather&quot;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Hour Of The Day&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Users Count&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Average Users Count By Hour Of The Day Across Weather&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_46_01.png" /></p>
</div>
<div class="section" id="bikes-are-rented-more-in-fall-and-much-less-in-spring">
<h3>Bikes are rented more in Fall and much less in Spring<a class="headerlink" href="#bikes-are-rented-more-in-fall-and-much-less-in-spring" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">season_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Spring&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Summer&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Fall&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Winter&#39;</span><span class="p">}</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span><span class="n">train_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span><span class="s2">&quot;season&quot;</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span> <span class="p">:</span> <span class="n">season_map</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hour</th>
      <th>season</th>
      <th>mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>48</th>
      <td>12</td>
      <td>Spring</td>
      <td>154.412281</td>
    </tr>
    <tr>
      <th>92</th>
      <td>23</td>
      <td>Spring</td>
      <td>45.333333</td>
    </tr>
    <tr>
      <th>27</th>
      <td>6</td>
      <td>Winter</td>
      <td>82.254386</td>
    </tr>
    <tr>
      <th>89</th>
      <td>22</td>
      <td>Summer</td>
      <td>154.192982</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>Summer</td>
      <td>58.473684</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;season&quot;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Hour Of The Day&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Users Count&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Average Users Count By Hour Of The Day Across Season&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_50_0.png" /></p>
</div>
<div class="section" id="bikes-are-rented-mostly-for-morning-evening-commutes-on-weekdays-and-mostly-daytime-rides-on-weekends">
<h3>Bikes are rented mostly for Morning/Evening commutes on Weekdays, and mostly Daytime rides on Weekends<a class="headerlink" href="#bikes-are-rented-mostly-for-morning-evening-commutes-on-weekdays-and-mostly-daytime-rides-on-weekends" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">day_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;Monday&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Tuesday&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Wednesday&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Thursday&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Friday&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="s1">&#39;Saturday&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span><span class="s1">&#39;Sunday&#39;</span><span class="p">}</span>
<span class="n">hueOrder</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Sunday&quot;</span><span class="p">,</span> <span class="s2">&quot;Monday&quot;</span><span class="p">,</span> <span class="s2">&quot;Tuesday&quot;</span><span class="p">,</span> <span class="s2">&quot;Wednesday&quot;</span><span class="p">,</span> <span class="s2">&quot;Thursday&quot;</span><span class="p">,</span> <span class="s2">&quot;Friday&quot;</span><span class="p">,</span> <span class="s2">&quot;Saturday&quot;</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;mean&#39;</span><span class="p">:</span><span class="n">train_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span><span class="s2">&quot;dow&quot;</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()})</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;dow&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;dow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span> <span class="p">:</span> <span class="n">day_map</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hour</th>
      <th>dow</th>
      <th>mean</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>103</th>
      <td>14</td>
      <td>Saturday</td>
      <td>398.409091</td>
    </tr>
    <tr>
      <th>134</th>
      <td>19</td>
      <td>Tuesday</td>
      <td>356.123077</td>
    </tr>
    <tr>
      <th>55</th>
      <td>7</td>
      <td>Sunday</td>
      <td>34.742424</td>
    </tr>
    <tr>
      <th>78</th>
      <td>11</td>
      <td>Tuesday</td>
      <td>145.609375</td>
    </tr>
    <tr>
      <th>67</th>
      <td>9</td>
      <td>Friday</td>
      <td>262.406250</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;dow&quot;</span><span class="p">],</span> <span class="n">hue_order</span><span class="o">=</span><span class="n">hueOrder</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Hour Of The Day&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Users Count&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Average Users Count By Hour Of The Day Across Weekdays&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_54_0.png" /></p>
</div>
<div class="section" id="renting-patterns-of-bikes-are-significantly-different-between-registered-and-casual-users">
<h3>Renting patterns of Bikes are significantly different between Registered and Casual Users<a class="headerlink" href="#renting-patterns-of-bikes-are-significantly-different-between-registered-and-casual-users" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#fig, axs = plt.subplots(1, 2, figsize=(15,5), sharex=False, sharey=False)</span>

<span class="c1">#train_df.boxplot(column=&#39;casual&#39;, by=&#39;hour&#39;, ax=axs[0])</span>
<span class="c1">#axs[0].set_ylabel(&#39;casual users&#39;)</span>
<span class="c1">#axs[0].set_title(&#39;&#39;)</span>

<span class="c1">#train_df.boxplot(column=&#39;registered&#39;, by=&#39;hour&#39;, ax=axs[1])</span>
<span class="c1">#axs[1].set_ylabel(&#39;registered users&#39;)</span>
<span class="c1">#axs[1].set_title(&#39;&#39;)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;casual&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;casual users&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;registered&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;registered users&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_57_01.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="p">[[</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span><span class="s2">&quot;casual&quot;</span><span class="p">,</span><span class="s2">&quot;registered&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hour</th>
      <th>casual</th>
      <th>registered</th>
    </tr>
    <tr>
      <th>datetime</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-01 00:00:00</th>
      <td>0</td>
      <td>3</td>
      <td>13</td>
    </tr>
    <tr>
      <th>2011-01-01 01:00:00</th>
      <td>1</td>
      <td>8</td>
      <td>32</td>
    </tr>
    <tr>
      <th>2011-01-01 02:00:00</th>
      <td>2</td>
      <td>5</td>
      <td>27</td>
    </tr>
    <tr>
      <th>2011-01-01 03:00:00</th>
      <td>3</td>
      <td>3</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2011-01-01 04:00:00</th>
      <td>4</td>
      <td>0</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">train_df</span><span class="p">[[</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span><span class="s2">&quot;casual&quot;</span><span class="p">,</span><span class="s2">&quot;registered&quot;</span><span class="p">]],</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;casual&#39;</span><span class="p">,</span> <span class="s1">&#39;registered&#39;</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;usertype&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>hour</th>
      <th>usertype</th>
      <th>count</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>casual</td>
      <td>3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>casual</td>
      <td>8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>casual</td>
      <td>5</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>casual</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>4</td>
      <td>casual</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">train_df_melt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">train_df</span><span class="p">[[</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span><span class="s2">&quot;casual&quot;</span><span class="p">,</span><span class="s2">&quot;registered&quot;</span><span class="p">]],</span> <span class="n">id_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">],</span> <span class="n">value_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;casual&#39;</span><span class="p">,</span> <span class="s1">&#39;registered&#39;</span><span class="p">],</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;usertype&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_df_melt</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;hour&quot;</span><span class="p">,</span> <span class="s2">&quot;usertype&quot;</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;hour&quot;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;usertype&quot;</span><span class="p">],</span> <span class="n">hue_order</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;casual&quot;</span><span class="p">,</span><span class="s2">&quot;registered&quot;</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Hour Of The Day&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Users Count&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Average Users Count By Hour Of The Day Across User Type&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_60_0.png" /></p>
<p>Above we can see that registered users have similar trend as count. Whereas, casual users have different trend. Thus, we can say that ‘hour’ is significant variable and our hypothesis is ‘true’.</p>
<p>We can notice that there are a lot of outliers while plotting the count of registered and casual users. These values are not generated due to error, so we consider them as natural outliers. They might be a result of groups of people taking up cycling (who are not registered). To treat such outliers, we will use logarithm transformation. Let’s look at the similar plot after log transformation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">log_count</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">df</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;log_count&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;log(count) of Users&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Boxplot of Log of Count grouped by hour&#39;</span><span class="p">)</span>

<span class="c1">#plt.suptitle(&quot;&quot;) # get rid of the pandas autogenerated title</span>
<span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;log_count&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_62_0.png" /></p>
</div>
<div class="section" id="on-workdays-most-bikes-are-rented-on-warm-mornings-and-evenings-sup-2-sup">
<h3>On Workdays most Bikes are rented on Warm Mornings and Evenings<sup>[2]</sup><a class="headerlink" href="#on-workdays-most-bikes-are-rented-on-warm-mornings-and-evenings-sup-2-sup" title="Permalink to this headline">¶</a></h3>
<p><sup>[4]</sup>When graphing a categorical variable vs. a continuous variable, it can be useful to create a scatter plot to visually examine distributions. Together with a box plot, it will allow us to see the distributions of our variables. Unfortunately, if our points occur close together, we will get a very uninformative smear. One way of making the scatter plot work is by adding jitter. With the jitter, a random amount is added or subtracted to each of the variables along the categorical axis. Where before, we may have had a categorical value vector that looked something like [1,2,2,2,1,3], post-jitter, they would look something like [1.05, 1.96, 2.05, 2, .97, 2.95]. Each value has had somewhere between [-0.05,0.05] added to it. This then means that when we plot our variables, we’ll see a cloud of points that represent our distribution, rather than a long smear.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hour_jitter</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="c1">#return h + ((np.random.randint(low=0, high=9, size=1)[0] - 4) / 10)</span>
    <span class="k">return</span> <span class="n">h</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hour_format</span><span class="p">(</span><span class="n">h</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">:00 AM&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="k">if</span> <span class="n">h</span> <span class="o">&lt;=</span> <span class="mi">12</span> <span class="k">else</span> <span class="s2">&quot;</span><span class="si">{:02d}</span><span class="s2">:00 PM&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">h</span><span class="o">%</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># jitter plot</span>
<span class="kn">import</span> <span class="nn">matplotlib.colors</span> <span class="k">as</span> <span class="nn">mcolors</span>
<span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>

<span class="c1"># color_map = plt.get_cmap(&quot;jet&quot;)</span>
<span class="n">color_map</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="nb">list</span><span class="p">([</span><span class="s2">&quot;#5e4fa2&quot;</span><span class="p">,</span> <span class="s2">&quot;#3288bd&quot;</span><span class="p">,</span> <span class="s2">&quot;#66c2a5&quot;</span><span class="p">,</span> <span class="s2">&quot;#abdda4&quot;</span><span class="p">,</span> <span class="s2">&quot;#e6f598&quot;</span><span class="p">,</span> <span class="s2">&quot;#fee08b&quot;</span><span class="p">,</span> <span class="s2">&quot;#fdae61&quot;</span><span class="p">,</span> <span class="s2">&quot;#f46d43&quot;</span><span class="p">,</span> <span class="s2">&quot;#d53e4f&quot;</span><span class="p">,</span> <span class="s2">&quot;#9e0142&quot;</span><span class="p">]))</span>
<span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;hour_jitter&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">hour_jitter</span><span class="p">)</span>
<span class="n">train_df</span><span class="p">[</span><span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;workingday&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;scatter&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;hour_jitter&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">18</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
    <span class="n">c</span><span class="o">=</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">color_map</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">hours</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">hour_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">hour_format</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">hours</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">hours</span><span class="p">,</span> <span class="n">hour_labels</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_66_0.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">train_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;hour_jitter&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Daily Trend:</strong> Like Hour, we will generate a variable for day from datetime variable and after that we’ll plot it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dayOfWeek</span><span class="o">=</span><span class="p">{</span><span class="mi">0</span><span class="p">:</span><span class="s1">&#39;Monday&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Tuesday&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Wednesday&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Thursday&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Friday&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">:</span><span class="s1">&#39;Saturday&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">:</span><span class="s1">&#39;Sunday&#39;</span><span class="p">}</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;weekday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;dow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">dayOfWeek</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;weekday&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;registered&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">all_df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;registered users&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;weekday&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;casual&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">all_df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;casual users&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">all_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;weekday&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_69_0.png" /></p>
<p><strong>Rain:</strong> We don’t have the ‘rain’ variable with us but have ‘weather’ which is sufficient to test our hypothesis. As per variable description, weather 3 represents light rain and weather 4 represents heavy rain. Take a look at the plot:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;weather&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;registered&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">all_df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;registered users&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;weather&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;casual&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">all_df</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;casual users&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_71_0.png" /></p>
<p>It is clearly satisfying our hypothesis.</p>
<p><strong>Temperature, Windspeed and Humidity:</strong> These are continuous variables so we can look at the correlation factor to validate hypothesis.</p>
</div>
<div class="section" id="correlation-between-count-and-features">
<h3>Correlation Between Count And Features<a class="headerlink" href="#correlation-between-count-and-features" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sub_df</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[[</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="s1">&#39;registered&#39;</span><span class="p">,</span> <span class="s1">&#39;casual&#39;</span><span class="p">,</span> <span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;atemp&#39;</span><span class="p">,</span> <span class="s1">&#39;humidity&#39;</span><span class="p">,</span> <span class="s1">&#39;windspeed&#39;</span><span class="p">,</span> <span class="s1">&#39;workingday&#39;</span><span class="p">,</span> <span class="s1">&#39;holiday&#39;</span><span class="p">]]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sub_df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>registered</th>
      <th>casual</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>workingday</th>
      <th>holiday</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1.000000</td>
      <td>0.970948</td>
      <td>0.690414</td>
      <td>0.394454</td>
      <td>0.389784</td>
      <td>-0.317371</td>
      <td>0.101369</td>
      <td>0.011965</td>
      <td>-0.008049</td>
    </tr>
    <tr>
      <th>registered</th>
      <td>0.970948</td>
      <td>1.000000</td>
      <td>0.497250</td>
      <td>0.318571</td>
      <td>0.314635</td>
      <td>-0.265458</td>
      <td>0.091052</td>
      <td>0.120154</td>
      <td>-0.023038</td>
    </tr>
    <tr>
      <th>casual</th>
      <td>0.690414</td>
      <td>0.497250</td>
      <td>1.000000</td>
      <td>0.467097</td>
      <td>0.462067</td>
      <td>-0.348187</td>
      <td>0.092276</td>
      <td>-0.319864</td>
      <td>0.040464</td>
    </tr>
    <tr>
      <th>temp</th>
      <td>0.394454</td>
      <td>0.318571</td>
      <td>0.467097</td>
      <td>1.000000</td>
      <td>0.984948</td>
      <td>-0.064949</td>
      <td>-0.017852</td>
      <td>0.033174</td>
      <td>0.002969</td>
    </tr>
    <tr>
      <th>atemp</th>
      <td>0.389784</td>
      <td>0.314635</td>
      <td>0.462067</td>
      <td>0.984948</td>
      <td>1.000000</td>
      <td>-0.043536</td>
      <td>-0.057473</td>
      <td>0.027851</td>
      <td>-0.003455</td>
    </tr>
    <tr>
      <th>humidity</th>
      <td>-0.317371</td>
      <td>-0.265458</td>
      <td>-0.348187</td>
      <td>-0.064949</td>
      <td>-0.043536</td>
      <td>1.000000</td>
      <td>-0.318607</td>
      <td>-0.011039</td>
      <td>0.012114</td>
    </tr>
    <tr>
      <th>windspeed</th>
      <td>0.101369</td>
      <td>0.091052</td>
      <td>0.092276</td>
      <td>-0.017852</td>
      <td>-0.057473</td>
      <td>-0.318607</td>
      <td>1.000000</td>
      <td>0.018454</td>
      <td>-0.000585</td>
    </tr>
    <tr>
      <th>workingday</th>
      <td>0.011965</td>
      <td>0.120154</td>
      <td>-0.319864</td>
      <td>0.033174</td>
      <td>0.027851</td>
      <td>-0.011039</td>
      <td>0.018454</td>
      <td>1.000000</td>
      <td>-0.213189</td>
    </tr>
    <tr>
      <th>holiday</th>
      <td>-0.008049</td>
      <td>-0.023038</td>
      <td>0.040464</td>
      <td>0.002969</td>
      <td>-0.003455</td>
      <td>0.012114</td>
      <td>-0.000585</td>
      <td>-0.213189</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">corrMatt</span> <span class="o">=</span> <span class="n">sub_df</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">corrMatt</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corrMatt</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=.</span><span class="mi">8</span><span class="p">,</span> <span class="n">square</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_76_0.png" /></p>
<p>Here are a few inferences you can draw by looking at the above histograms:</p>
<ul class="simple">
<li><p>Variable temp is positively correlated with dependent variables (casual is more compare to registered)</p></li>
<li><p>Variable atemp is highly correlated with temp.</p></li>
<li><p>Windspeed has lower correlation as compared to temp and humidity</p></li>
</ul>
<p><strong>Time:</strong> Let’s extract year of each observation from the datetime column and see the trend of bike demand over year.</p>
</div>
<div class="section" id="distribution-of-data-between-train-and-test-set-based-on-season">
<h3>Distribution of data between Train and Test set based on Season<a class="headerlink" href="#distribution-of-data-between-train-and-test-set-based-on-season" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">season_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Spring&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Summer&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Fall&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Winter&#39;</span><span class="p">}</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[[</span><span class="s1">&#39;data_set&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;season&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span> <span class="p">:</span> <span class="n">season_map</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;data_set&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;season&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_80_0.png" /></p>
</div>
<div class="section" id="distribution-of-data-between-train-and-test-set-based-on-weather">
<h3>Distribution of data between Train and Test set based on Weather<a class="headerlink" href="#distribution-of-data-between-train-and-test-set-based-on-weather" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">weather_map</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:</span><span class="s1">&#39;Good&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span><span class="s1">&#39;Normal&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">:</span><span class="s1">&#39;Bad&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">:</span><span class="s1">&#39;Worse&#39;</span><span class="p">}</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[[</span><span class="s1">&#39;data_set&#39;</span><span class="p">,</span> <span class="s1">&#39;weather&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s1">&#39;weather&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;weather&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">d</span> <span class="p">:</span> <span class="n">weather_map</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;data_set&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;weather&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_83_0.png" /></p>
</div>
<div class="section" id="distribution-of-count-of-users-train-and-test-set-based-on-year">
<h3>Distribution of count of users Train and Test set based on Year<a class="headerlink" href="#distribution-of-count-of-users-train-and-test-set-based-on-year" title="Permalink to this headline">¶</a></h3>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_df</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count of Users&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Boxplot of Count grouped by year&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p><img alt="png" src="../../_images/output_85_01.png" /></p>
<p>We can see that 2012 has higher bike demand as compared to 2011.</p>
<p><strong>Pollution &amp; Traffic:</strong> We don’t have the variable related with these metrics in our data set so we cannot test this hypothesis.</p>
</div>
</div>
<div class="section" id="feature-engineering">
<h2>5. Feature Engineering<a class="headerlink" href="#feature-engineering" title="Permalink to this headline">¶</a></h2>
<p>In addition to existing independent variables, we will create new variables to improve the prediction power of model. Initially, we have generated new variables like hour, month, day and year.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># feature engineer a new column whether its a peak hour or not</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;peak&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[[</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;workingday&#39;</span><span class="p">]]</span>\
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;workingday&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">or</span> <span class="mi">17</span> <span class="o">&lt;=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;hour&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">18</span><span class="p">))</span> \
                            <span class="ow">or</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;workingday&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="mi">10</span> <span class="o">&lt;=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;workingday&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">19</span><span class="p">))</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># sandy</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;holiday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[[</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;holiday&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]]</span>\
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2012</span> <span class="ow">and</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">30</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># christmas and others</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;holiday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[[</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;holiday&#39;</span><span class="p">]]</span>\
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">12</span> <span class="ow">and</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">26</span><span class="p">,</span> <span class="mi">31</span><span class="p">])</span> <span class="k">else</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;holiday&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;workingday&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[[</span><span class="s1">&#39;month&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="s1">&#39;workingday&#39;</span><span class="p">]]</span>\
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">12</span> <span class="ow">and</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">24</span><span class="p">,</span> <span class="mi">31</span><span class="p">]</span> <span class="k">else</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;workingday&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># from histogram</span>
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;ideal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[[</span><span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;windspeed&#39;</span><span class="p">]]</span>\
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;temp&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">27</span> <span class="ow">and</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;windspeed&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">30</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
    
<span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;sticky&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[[</span><span class="s1">&#39;humidity&#39;</span><span class="p">,</span> <span class="s1">&#39;workingday&#39;</span><span class="p">]]</span>\
    <span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;workingday&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;humidity&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">all_df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>atemp</th>
      <th>casual</th>
      <th>count</th>
      <th>data_set</th>
      <th>datetime</th>
      <th>holiday</th>
      <th>humidity</th>
      <th>registered</th>
      <th>season</th>
      <th>temp</th>
      <th>weather</th>
      <th>windspeed</th>
      <th>workingday</th>
      <th>casual_log</th>
      <th>registered_log</th>
      <th>count_log</th>
      <th>date</th>
      <th>day</th>
      <th>month</th>
      <th>year</th>
      <th>hour</th>
      <th>dow</th>
      <th>woy</th>
      <th>count_season</th>
      <th>peak</th>
      <th>ideal</th>
      <th>sticky</th>
    </tr>
    <tr>
      <th>datetime</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2012-08-30 02:00:00</th>
      <td>29.545</td>
      <td>0</td>
      <td>0</td>
      <td>test</td>
      <td>2012-08-30 02:00:00</td>
      <td>0</td>
      <td>73</td>
      <td>0</td>
      <td>3</td>
      <td>25.42</td>
      <td>1</td>
      <td>0.0000</td>
      <td>1</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2012-08-30</td>
      <td>30</td>
      <td>8</td>
      <td>2012</td>
      <td>2</td>
      <td>3</td>
      <td>35</td>
      <td>640662</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2012-08-14 20:00:00</th>
      <td>35.605</td>
      <td>65</td>
      <td>436</td>
      <td>train</td>
      <td>2012-08-14 20:00:00</td>
      <td>0</td>
      <td>74</td>
      <td>371</td>
      <td>3</td>
      <td>30.34</td>
      <td>1</td>
      <td>15.0013</td>
      <td>1</td>
      <td>4.189655</td>
      <td>5.918894</td>
      <td>6.079933</td>
      <td>2012-08-14</td>
      <td>14</td>
      <td>8</td>
      <td>2012</td>
      <td>20</td>
      <td>1</td>
      <td>33</td>
      <td>640662</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2012-05-01 04:00:00</th>
      <td>25.000</td>
      <td>1</td>
      <td>8</td>
      <td>train</td>
      <td>2012-05-01 04:00:00</td>
      <td>0</td>
      <td>72</td>
      <td>7</td>
      <td>2</td>
      <td>21.32</td>
      <td>2</td>
      <td>6.0032</td>
      <td>1</td>
      <td>0.693147</td>
      <td>2.079442</td>
      <td>2.197225</td>
      <td>2012-05-01</td>
      <td>1</td>
      <td>5</td>
      <td>2012</td>
      <td>4</td>
      <td>1</td>
      <td>18</td>
      <td>588282</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2011-07-13 19:00:00</th>
      <td>33.335</td>
      <td>79</td>
      <td>419</td>
      <td>train</td>
      <td>2011-07-13 19:00:00</td>
      <td>0</td>
      <td>79</td>
      <td>340</td>
      <td>3</td>
      <td>28.70</td>
      <td>1</td>
      <td>7.0015</td>
      <td>1</td>
      <td>4.382027</td>
      <td>5.831882</td>
      <td>6.040255</td>
      <td>2011-07-13</td>
      <td>13</td>
      <td>7</td>
      <td>2011</td>
      <td>19</td>
      <td>2</td>
      <td>28</td>
      <td>640662</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2012-02-05 09:00:00</th>
      <td>11.365</td>
      <td>9</td>
      <td>92</td>
      <td>train</td>
      <td>2012-02-05 09:00:00</td>
      <td>0</td>
      <td>70</td>
      <td>83</td>
      <td>1</td>
      <td>9.84</td>
      <td>2</td>
      <td>15.0013</td>
      <td>0</td>
      <td>2.302585</td>
      <td>4.430817</td>
      <td>4.532599</td>
      <td>2012-02-05</td>
      <td>5</td>
      <td>2</td>
      <td>2012</td>
      <td>9</td>
      <td>6</td>
      <td>5</td>
      <td>312498</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2011-05-22 02:00:00</th>
      <td>25.000</td>
      <td>0</td>
      <td>0</td>
      <td>test</td>
      <td>2011-05-22 02:00:00</td>
      <td>0</td>
      <td>94</td>
      <td>0</td>
      <td>2</td>
      <td>21.32</td>
      <td>1</td>
      <td>7.0015</td>
      <td>0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2011-05-22</td>
      <td>22</td>
      <td>5</td>
      <td>2011</td>
      <td>2</td>
      <td>6</td>
      <td>20</td>
      <td>588282</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2011-11-11 22:00:00</th>
      <td>15.910</td>
      <td>13</td>
      <td>91</td>
      <td>train</td>
      <td>2011-11-11 22:00:00</td>
      <td>0</td>
      <td>39</td>
      <td>78</td>
      <td>4</td>
      <td>13.12</td>
      <td>1</td>
      <td>12.9980</td>
      <td>0</td>
      <td>2.639057</td>
      <td>4.369448</td>
      <td>4.521789</td>
      <td>2011-11-11</td>
      <td>11</td>
      <td>11</td>
      <td>2011</td>
      <td>22</td>
      <td>4</td>
      <td>45</td>
      <td>544034</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2011-04-10 23:00:00</th>
      <td>22.725</td>
      <td>5</td>
      <td>32</td>
      <td>train</td>
      <td>2011-04-10 23:00:00</td>
      <td>0</td>
      <td>88</td>
      <td>27</td>
      <td>2</td>
      <td>18.86</td>
      <td>1</td>
      <td>23.9994</td>
      <td>0</td>
      <td>1.791759</td>
      <td>3.332205</td>
      <td>3.496508</td>
      <td>2011-04-10</td>
      <td>10</td>
      <td>4</td>
      <td>2011</td>
      <td>23</td>
      <td>6</td>
      <td>14</td>
      <td>588282</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2012-05-07 15:00:00</th>
      <td>31.060</td>
      <td>76</td>
      <td>262</td>
      <td>train</td>
      <td>2012-05-07 15:00:00</td>
      <td>0</td>
      <td>53</td>
      <td>186</td>
      <td>2</td>
      <td>25.42</td>
      <td>2</td>
      <td>19.9995</td>
      <td>1</td>
      <td>4.343805</td>
      <td>5.231109</td>
      <td>5.572154</td>
      <td>2012-05-07</td>
      <td>7</td>
      <td>5</td>
      <td>2012</td>
      <td>15</td>
      <td>0</td>
      <td>19</td>
      <td>588282</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2011-06-23 09:00:00</th>
      <td>34.850</td>
      <td>0</td>
      <td>0</td>
      <td>test</td>
      <td>2011-06-23 09:00:00</td>
      <td>0</td>
      <td>70</td>
      <td>0</td>
      <td>3</td>
      <td>30.34</td>
      <td>2</td>
      <td>8.9981</td>
      <td>1</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>2011-06-23</td>
      <td>23</td>
      <td>6</td>
      <td>2011</td>
      <td>9</td>
      <td>3</td>
      <td>25</td>
      <td>640662</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="section" id="training-models">
<h2>6. Training Models<a class="headerlink" href="#training-models" title="Permalink to this headline">¶</a></h2>
<p>We create a machine learning model to predict for casual and registered users separately and then combine them to generate the overall prediction for the counts.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># instead of randomly splitting our training data </span>
<span class="c1"># for cross validation, let&#39;s construct a framework that&#39;s more</span>
<span class="c1"># in line with how the data is divvied up for this competition</span>
<span class="c1"># (given first 19 days of each month, what is demand for remaining days)</span>
<span class="c1"># so, let&#39;s split our training data into 2 time contiguous datasets</span>
<span class="c1"># for fitting and validating our model (days 1-14 vs. days 15-19).</span>

<span class="c1"># also, since submissions are evaluated based on the</span>
<span class="c1"># root mean squared logarithmic error (RMSLE), let&#39;s replicate</span>
<span class="c1"># that computation as we test and tune our model.</span>

<span class="n">train_df</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[</span><span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;data_set&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;train&#39;</span><span class="p">]</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">all_df</span><span class="p">[</span><span class="n">all_df</span><span class="p">[</span><span class="s1">&#39;data_set&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;test&#39;</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">get_rmsle</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">y_actual</span><span class="p">):</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y_pred</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">y_actual</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">mean_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_error</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">custom_train_valid_split</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">cutoff_day</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
    <span class="n">train</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">cutoff_day</span><span class="p">]</span>
    <span class="n">valid</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">cutoff_day</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">train</span><span class="p">,</span> <span class="n">valid</span>

<span class="k">def</span> <span class="nf">prep_train_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">input_cols</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">input_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">y_r</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;registered_log&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">y_c</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;casual_log&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="k">return</span> <span class="n">X</span><span class="p">,</span> <span class="n">y_r</span><span class="p">,</span> <span class="n">y_c</span>

<span class="c1"># predict on validation set &amp; transform output back from log scale</span>
<span class="k">def</span> <span class="nf">predict_on_validation_set</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">input_cols</span><span class="p">):</span>
    
    <span class="n">train</span><span class="p">,</span> <span class="n">valid</span> <span class="o">=</span> <span class="n">custom_train_valid_split</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>

    <span class="c1"># prepare training &amp; validation set</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_r</span><span class="p">,</span> <span class="n">y_train_c</span> <span class="o">=</span> <span class="n">prep_train_data</span><span class="p">(</span><span class="n">train</span><span class="p">,</span> <span class="n">input_cols</span><span class="p">)</span>
    <span class="n">X_valid</span><span class="p">,</span> <span class="n">y_valid_r</span><span class="p">,</span> <span class="n">y_valid_c</span> <span class="o">=</span> <span class="n">prep_train_data</span><span class="p">(</span><span class="n">valid</span><span class="p">,</span> <span class="n">input_cols</span><span class="p">)</span>

    <span class="n">model_r</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_r</span><span class="p">)</span>
    <span class="n">y_pred_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model_r</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">model_c</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_c</span><span class="p">)</span>
    <span class="n">y_pred_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model_c</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_valid</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">y_pred_comb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y_pred_r</span> <span class="o">+</span> <span class="n">y_pred_c</span><span class="p">)</span>
    <span class="n">y_pred_comb</span><span class="p">[</span><span class="n">y_pred_comb</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">y_actual_comb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y_valid_r</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">y_valid_c</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>

    <span class="n">rmsle</span> <span class="o">=</span> <span class="n">get_rmsle</span><span class="p">(</span><span class="n">y_pred_comb</span><span class="p">,</span> <span class="n">y_actual_comb</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">y_pred_comb</span><span class="p">,</span> <span class="n">y_actual_comb</span><span class="p">,</span> <span class="n">rmsle</span><span class="p">)</span>


<span class="c1"># predict on test set &amp; transform output back from log scale</span>
<span class="k">def</span> <span class="nf">predict_on_test_set</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">input_cols</span><span class="p">):</span>
    
    <span class="c1"># prepare training set</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_r</span><span class="p">,</span> <span class="n">y_train_c</span> <span class="o">=</span> <span class="n">prep_train_data</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">input_cols</span><span class="p">)</span>

    <span class="c1"># prepare testing set</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="n">input_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    
    <span class="n">model_c</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_c</span><span class="p">)</span>
    <span class="n">y_pred_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model_c</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">model_r</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_r</span><span class="p">)</span>
    <span class="n">y_pred_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model_r</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
    
    <span class="c1"># add casual &amp; registered predictions together</span>
    <span class="n">y_pred_comb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y_pred_r</span> <span class="o">+</span> <span class="n">y_pred_c</span><span class="p">)</span>
    <span class="n">y_pred_comb</span><span class="p">[</span><span class="n">y_pred_comb</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="k">return</span> <span class="n">y_pred_comb</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;min_samples_split&#39;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;n_jobs&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span class="n">rf_model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="n">rf_cols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;weather&#39;</span><span class="p">,</span> <span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;atemp&#39;</span><span class="p">,</span> <span class="s1">&#39;windspeed&#39;</span><span class="p">,</span>
    <span class="s1">&#39;workingday&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="s1">&#39;holiday&#39;</span><span class="p">,</span> <span class="s1">&#39;sticky&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;dow&#39;</span><span class="p">,</span> <span class="s1">&#39;woy&#39;</span><span class="p">,</span> <span class="s1">&#39;peak&#39;</span>
    <span class="p">]</span>

<span class="p">(</span><span class="n">rf_pred</span><span class="p">,</span> <span class="n">rf_actual</span><span class="p">,</span> <span class="n">rf_rmsle</span><span class="p">)</span> <span class="o">=</span> <span class="n">predict_on_validation_set</span><span class="p">(</span><span class="n">rf_model</span><span class="p">,</span> <span class="n">rf_cols</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">rf_rmsle</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0.434625932998
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">all_df</span><span class="p">[</span><span class="n">rf_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>windspeed</th>
      <th>workingday</th>
      <th>season</th>
      <th>holiday</th>
      <th>sticky</th>
      <th>hour</th>
      <th>dow</th>
      <th>woy</th>
      <th>peak</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>weather</th>
      <td>1.000000</td>
      <td>-0.102640</td>
      <td>-0.105563</td>
      <td>0.026226</td>
      <td>0.042061</td>
      <td>-0.014524</td>
      <td>0.038472</td>
      <td>0.243523</td>
      <td>-0.020203</td>
      <td>-0.046424</td>
      <td>0.009692</td>
      <td>0.013506</td>
    </tr>
    <tr>
      <th>temp</th>
      <td>-0.102640</td>
      <td>1.000000</td>
      <td>0.987672</td>
      <td>-0.023125</td>
      <td>0.069153</td>
      <td>0.312025</td>
      <td>-0.101406</td>
      <td>-0.007074</td>
      <td>0.137603</td>
      <td>-0.036220</td>
      <td>0.198641</td>
      <td>0.044723</td>
    </tr>
    <tr>
      <th>atemp</th>
      <td>-0.105563</td>
      <td>0.987672</td>
      <td>1.000000</td>
      <td>-0.062336</td>
      <td>0.067594</td>
      <td>0.319380</td>
      <td>-0.101800</td>
      <td>0.004717</td>
      <td>0.133750</td>
      <td>-0.038918</td>
      <td>0.205561</td>
      <td>0.042167</td>
    </tr>
    <tr>
      <th>windspeed</th>
      <td>0.026226</td>
      <td>-0.023125</td>
      <td>-0.062336</td>
      <td>1.000000</td>
      <td>-0.001937</td>
      <td>-0.149773</td>
      <td>0.008593</td>
      <td>-0.187671</td>
      <td>0.137252</td>
      <td>0.003274</td>
      <td>-0.131613</td>
      <td>0.054581</td>
    </tr>
    <tr>
      <th>workingday</th>
      <td>0.042061</td>
      <td>0.069153</td>
      <td>0.067594</td>
      <td>-0.001937</td>
      <td>1.000000</td>
      <td>0.010879</td>
      <td>-0.091171</td>
      <td>0.536900</td>
      <td>0.002185</td>
      <td>-0.698028</td>
      <td>-0.025700</td>
      <td>0.207653</td>
    </tr>
    <tr>
      <th>season</th>
      <td>-0.014524</td>
      <td>0.312025</td>
      <td>0.319380</td>
      <td>-0.149773</td>
      <td>0.010879</td>
      <td>1.000000</td>
      <td>-0.109490</td>
      <td>0.095556</td>
      <td>-0.006117</td>
      <td>-0.007448</td>
      <td>0.814302</td>
      <td>-0.001289</td>
    </tr>
    <tr>
      <th>holiday</th>
      <td>0.038472</td>
      <td>-0.101406</td>
      <td>-0.101800</td>
      <td>0.008593</td>
      <td>-0.091171</td>
      <td>-0.109490</td>
      <td>1.000000</td>
      <td>-0.029345</td>
      <td>0.007158</td>
      <td>-0.049770</td>
      <td>0.104596</td>
      <td>-0.004713</td>
    </tr>
    <tr>
      <th>sticky</th>
      <td>0.243523</td>
      <td>-0.007074</td>
      <td>0.004717</td>
      <td>-0.187671</td>
      <td>0.536900</td>
      <td>0.095556</td>
      <td>-0.029345</td>
      <td>1.000000</td>
      <td>-0.186289</td>
      <td>-0.399949</td>
      <td>0.096672</td>
      <td>0.050274</td>
    </tr>
    <tr>
      <th>hour</th>
      <td>-0.020203</td>
      <td>0.137603</td>
      <td>0.133750</td>
      <td>0.137252</td>
      <td>0.002185</td>
      <td>-0.006117</td>
      <td>0.007158</td>
      <td>-0.186289</td>
      <td>1.000000</td>
      <td>-0.002893</td>
      <td>-0.005437</td>
      <td>0.124008</td>
    </tr>
    <tr>
      <th>dow</th>
      <td>-0.046424</td>
      <td>-0.036220</td>
      <td>-0.038918</td>
      <td>0.003274</td>
      <td>-0.698028</td>
      <td>-0.007448</td>
      <td>-0.049770</td>
      <td>-0.399949</td>
      <td>-0.002893</td>
      <td>1.000000</td>
      <td>0.009368</td>
      <td>-0.148325</td>
    </tr>
    <tr>
      <th>woy</th>
      <td>0.009692</td>
      <td>0.198641</td>
      <td>0.205561</td>
      <td>-0.131613</td>
      <td>-0.025700</td>
      <td>0.814302</td>
      <td>0.104596</td>
      <td>0.096672</td>
      <td>-0.005437</td>
      <td>0.009368</td>
      <td>1.000000</td>
      <td>-0.007311</td>
    </tr>
    <tr>
      <th>peak</th>
      <td>0.013506</td>
      <td>0.044723</td>
      <td>0.042167</td>
      <td>0.054581</td>
      <td>0.207653</td>
      <td>-0.001289</td>
      <td>-0.004713</td>
      <td>0.050274</td>
      <td>0.124008</td>
      <td>-0.148325</td>
      <td>-0.007311</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;subsample&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s1">&#39;loss&#39;</span><span class="p">:</span> <span class="s1">&#39;ls&#39;</span><span class="p">}</span>
<span class="n">gbm_model</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="n">gbm_cols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;weather&#39;</span><span class="p">,</span> <span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;atemp&#39;</span><span class="p">,</span> <span class="s1">&#39;humidity&#39;</span><span class="p">,</span> <span class="s1">&#39;windspeed&#39;</span><span class="p">,</span>
    <span class="s1">&#39;holiday&#39;</span><span class="p">,</span> <span class="s1">&#39;workingday&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;dow&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;ideal&#39;</span><span class="p">,</span> <span class="s1">&#39;count_season&#39;</span><span class="p">,</span>
<span class="p">]</span>

<span class="p">(</span><span class="n">gbm_pred</span><span class="p">,</span> <span class="n">gbm_actual</span><span class="p">,</span> <span class="n">gbm_rmsle</span><span class="p">)</span> <span class="o">=</span> <span class="n">predict_on_validation_set</span><span class="p">(</span><span class="n">gbm_model</span><span class="p">,</span> <span class="n">gbm_cols</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">gbm_rmsle</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0.313091436534
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">all_df</span><span class="p">[</span><span class="n">gbm_cols</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>weather</th>
      <th>temp</th>
      <th>atemp</th>
      <th>humidity</th>
      <th>windspeed</th>
      <th>holiday</th>
      <th>workingday</th>
      <th>season</th>
      <th>hour</th>
      <th>dow</th>
      <th>year</th>
      <th>ideal</th>
      <th>count_season</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>weather</th>
      <td>1.000000</td>
      <td>-0.102640</td>
      <td>-0.105563</td>
      <td>0.418130</td>
      <td>0.026226</td>
      <td>0.038472</td>
      <td>0.042061</td>
      <td>-0.014524</td>
      <td>-0.020203</td>
      <td>-0.046424</td>
      <td>-0.019157</td>
      <td>-0.145407</td>
      <td>-0.051863</td>
    </tr>
    <tr>
      <th>temp</th>
      <td>-0.102640</td>
      <td>1.000000</td>
      <td>0.987672</td>
      <td>-0.069881</td>
      <td>-0.023125</td>
      <td>-0.101406</td>
      <td>0.069153</td>
      <td>0.312025</td>
      <td>0.137603</td>
      <td>-0.036220</td>
      <td>0.040913</td>
      <td>0.727266</td>
      <td>0.705172</td>
    </tr>
    <tr>
      <th>atemp</th>
      <td>-0.105563</td>
      <td>0.987672</td>
      <td>1.000000</td>
      <td>-0.051918</td>
      <td>-0.062336</td>
      <td>-0.101800</td>
      <td>0.067594</td>
      <td>0.319380</td>
      <td>0.133750</td>
      <td>-0.038918</td>
      <td>0.039222</td>
      <td>0.701874</td>
      <td>0.701434</td>
    </tr>
    <tr>
      <th>humidity</th>
      <td>0.418130</td>
      <td>-0.069881</td>
      <td>-0.051918</td>
      <td>1.000000</td>
      <td>-0.290105</td>
      <td>0.014029</td>
      <td>0.014316</td>
      <td>0.150625</td>
      <td>-0.276498</td>
      <td>-0.035233</td>
      <td>-0.083546</td>
      <td>-0.141678</td>
      <td>0.113724</td>
    </tr>
    <tr>
      <th>windspeed</th>
      <td>0.026226</td>
      <td>-0.023125</td>
      <td>-0.062336</td>
      <td>-0.290105</td>
      <td>1.000000</td>
      <td>0.008593</td>
      <td>-0.001937</td>
      <td>-0.149773</td>
      <td>0.137252</td>
      <td>0.003274</td>
      <td>-0.008740</td>
      <td>-0.051489</td>
      <td>-0.113048</td>
    </tr>
    <tr>
      <th>holiday</th>
      <td>0.038472</td>
      <td>-0.101406</td>
      <td>-0.101800</td>
      <td>0.014029</td>
      <td>0.008593</td>
      <td>1.000000</td>
      <td>-0.091171</td>
      <td>-0.109490</td>
      <td>0.007158</td>
      <td>-0.049770</td>
      <td>0.006293</td>
      <td>-0.054138</td>
      <td>-0.146902</td>
    </tr>
    <tr>
      <th>workingday</th>
      <td>0.042061</td>
      <td>0.069153</td>
      <td>0.067594</td>
      <td>0.014316</td>
      <td>-0.001937</td>
      <td>-0.091171</td>
      <td>1.000000</td>
      <td>0.010879</td>
      <td>0.002185</td>
      <td>-0.698028</td>
      <td>-0.007959</td>
      <td>0.023068</td>
      <td>0.044535</td>
    </tr>
    <tr>
      <th>season</th>
      <td>-0.014524</td>
      <td>0.312025</td>
      <td>0.319380</td>
      <td>0.150625</td>
      <td>-0.149773</td>
      <td>-0.109490</td>
      <td>0.010879</td>
      <td>1.000000</td>
      <td>-0.006117</td>
      <td>-0.007448</td>
      <td>-0.010742</td>
      <td>0.156455</td>
      <td>0.663537</td>
    </tr>
    <tr>
      <th>hour</th>
      <td>-0.020203</td>
      <td>0.137603</td>
      <td>0.133750</td>
      <td>-0.276498</td>
      <td>0.137252</td>
      <td>0.007158</td>
      <td>0.002185</td>
      <td>-0.006117</td>
      <td>1.000000</td>
      <td>-0.002893</td>
      <td>-0.003867</td>
      <td>0.113745</td>
      <td>-0.008248</td>
    </tr>
    <tr>
      <th>dow</th>
      <td>-0.046424</td>
      <td>-0.036220</td>
      <td>-0.038918</td>
      <td>-0.035233</td>
      <td>0.003274</td>
      <td>-0.049770</td>
      <td>-0.698028</td>
      <td>-0.007448</td>
      <td>-0.002893</td>
      <td>1.000000</td>
      <td>0.000977</td>
      <td>-0.009208</td>
      <td>-0.014472</td>
    </tr>
    <tr>
      <th>year</th>
      <td>-0.019157</td>
      <td>0.040913</td>
      <td>0.039222</td>
      <td>-0.083546</td>
      <td>-0.008740</td>
      <td>0.006293</td>
      <td>-0.007959</td>
      <td>-0.010742</td>
      <td>-0.003867</td>
      <td>0.000977</td>
      <td>1.000000</td>
      <td>0.000788</td>
      <td>-0.009706</td>
    </tr>
    <tr>
      <th>ideal</th>
      <td>-0.145407</td>
      <td>0.727266</td>
      <td>0.701874</td>
      <td>-0.141678</td>
      <td>-0.051489</td>
      <td>-0.054138</td>
      <td>0.023068</td>
      <td>0.156455</td>
      <td>0.113745</td>
      <td>-0.009208</td>
      <td>0.000788</td>
      <td>1.000000</td>
      <td>0.462633</td>
    </tr>
    <tr>
      <th>count_season</th>
      <td>-0.051863</td>
      <td>0.705172</td>
      <td>0.701434</td>
      <td>0.113724</td>
      <td>-0.113048</td>
      <td>-0.146902</td>
      <td>0.044535</td>
      <td>0.663537</td>
      <td>-0.008248</td>
      <td>-0.014472</td>
      <td>-0.009706</td>
      <td>0.462633</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="section" id="stacking">
<h2>7. Stacking<a class="headerlink" href="#stacking" title="Permalink to this headline">¶</a></h2>
<p>We can combine the predictions of two or more models to create a meta prediction.</p>
<p>It’s much like cross validation. Take 5-fold stacking as an example. First we split the training data into 5 folds. Next we will do 5 iterations. In each iteration, train every base model on 4 folds and predict on the hold-out fold. <strong>We have to keep the predictions on the testing data as well</strong>. This way, in each iteration every base model will make predictions on 1 fold of the training data and all of the testing data. After 5 iterations we will obtain a matrix of shape <code class="docutils literal notranslate"><span class="pre">#(samples</span> <span class="pre">in</span> <span class="pre">training</span> <span class="pre">data)</span> <span class="pre">X</span> <span class="pre">#(base</span> <span class="pre">models)</span></code>. This matrix is then fed to the stacker (it’s just another model) in the second level. After the stacker is fitted, use the predictions on testing data by base models (<strong>each base model is predicts on the test data, since there are 5 base models we will get 5 predictions on thesame test data, therefore we have to take an average to obtain a matrix of the same shape</strong>) as the input for the stacker and obtain our final predictions.</p>
<p><img alt="stacking" src="machine-learning-with-python/kaggle-bike-sharing-demand/assets/stacking.jpg" /></p>
<div class="section" id="manual-stacking">
<h3>7.1 Manual Stacking<a class="headerlink" href="#manual-stacking" title="Permalink to this headline">¶</a></h3>
<p>We can stack the predictions of two or more different models in a pre-defined weighted mechanism to get the final prediction. Instead of relying on the prediction of a single model we average out the predictions from two or more models.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># the blend gives a better score on the leaderboard, even though it does not on the validation set</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="o">*</span><span class="n">rf_pred</span> <span class="o">+</span> <span class="o">.</span><span class="mi">8</span><span class="o">*</span><span class="n">gbm_pred</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">get_rmsle</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">rf_actual</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0.316017221761
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">rf_pred</span> <span class="o">=</span> <span class="n">predict_on_test_set</span><span class="p">(</span><span class="n">rf_model</span><span class="p">,</span> <span class="n">rf_cols</span><span class="p">)</span>
<span class="n">gbm_pred</span> <span class="o">=</span> <span class="n">predict_on_test_set</span><span class="p">(</span><span class="n">gbm_model</span><span class="p">,</span> <span class="n">gbm_cols</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="o">.</span><span class="mi">2</span><span class="o">*</span><span class="n">rf_pred</span> <span class="o">+</span> <span class="o">.</span><span class="mi">8</span><span class="o">*</span><span class="n">gbm_pred</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># output predictions for submission</span>
<span class="n">submit_manual_blend_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[[</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">submit_manual_blend_df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pred</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">submit_manual_blend_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>count</th>
    </tr>
    <tr>
      <th>datetime</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-20 00:00:00</th>
      <td>2011-01-20 00:00:00</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>2011-01-20 01:00:00</th>
      <td>2011-01-20 01:00:00</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>2011-01-20 02:00:00</th>
      <td>2011-01-20 02:00:00</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2011-01-20 03:00:00</th>
      <td>2011-01-20 03:00:00</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2011-01-20 04:00:00</th>
      <td>2011-01-20 04:00:00</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">submit_manual_blend_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;output/submit_manual_blend.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="stacking-with-linear-regression">
<h3>7.1 Stacking  with Linear Regression<a class="headerlink" href="#stacking-with-linear-regression" title="Permalink to this headline">¶</a></h3>
<p>In the previous section we manually assigned weights to the two classifiers and blended the predictions. Here we will train the same two classifiers with different input cols on the data and then combine the predictions of the two classifiers using a LinearRegressor. The LinearRegressor acts as a meta-classifier which learnes what should be the weighted combination of the two level 0 classifiers.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Level 0 RandomForestRegressor</span>
<span class="n">rf_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">15</span><span class="p">,</span> <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;min_samples_split&#39;</span> <span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;n_jobs&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span class="n">rf_model</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">rf_params</span><span class="p">)</span>
<span class="n">rf_cols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;weather&#39;</span><span class="p">,</span> <span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;atemp&#39;</span><span class="p">,</span> <span class="s1">&#39;windspeed&#39;</span><span class="p">,</span>
    <span class="s1">&#39;workingday&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">,</span> <span class="s1">&#39;holiday&#39;</span><span class="p">,</span> <span class="s1">&#39;sticky&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;dow&#39;</span><span class="p">,</span> <span class="s1">&#39;woy&#39;</span><span class="p">,</span> <span class="s1">&#39;peak&#39;</span>
    <span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Level 0 GradientBoostingRegressor</span>
<span class="n">gbm_params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="s1">&#39;max_depth&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span> <span class="s1">&#39;random_state&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;min_samples_leaf&#39;</span> <span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;subsample&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s1">&#39;loss&#39;</span><span class="p">:</span> <span class="s1">&#39;ls&#39;</span><span class="p">}</span>
<span class="n">gbm_model</span> <span class="o">=</span> <span class="n">GradientBoostingRegressor</span><span class="p">(</span><span class="o">**</span><span class="n">gbm_params</span><span class="p">)</span>
<span class="n">gbm_cols</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;weather&#39;</span><span class="p">,</span> <span class="s1">&#39;temp&#39;</span><span class="p">,</span> <span class="s1">&#39;atemp&#39;</span><span class="p">,</span> <span class="s1">&#39;humidity&#39;</span><span class="p">,</span> <span class="s1">&#39;windspeed&#39;</span><span class="p">,</span>
    <span class="s1">&#39;holiday&#39;</span><span class="p">,</span> <span class="s1">&#39;workingday&#39;</span><span class="p">,</span> <span class="s1">&#39;season&#39;</span><span class="p">,</span>
    <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;dow&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;ideal&#39;</span><span class="p">,</span> <span class="s1">&#39;count_season&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">clf_input_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">rf_cols</span><span class="p">,</span> <span class="n">gbm_cols</span><span class="p">]</span>
<span class="n">clfs</span> <span class="o">=</span> <span class="p">[</span><span class="n">rf_model</span><span class="p">,</span> <span class="n">gbm_model</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create train and test sets for blending and Pre-allocate the data</span>
<span class="n">blend_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">train_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">clfs</span><span class="p">)))</span>
<span class="n">blend_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">test_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">clfs</span><span class="p">)))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># For each classifier, we train the classifier with its corresponding input_cols </span>
<span class="c1"># and record the predictions on the train and the test set</span>
<span class="k">for</span> <span class="n">clf_index</span><span class="p">,</span> <span class="p">(</span><span class="n">input_cols</span><span class="p">,</span> <span class="n">clf</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">clf_input_cols</span><span class="p">,</span> <span class="n">clfs</span><span class="p">)):</span>
    
    <span class="c1"># prepare training and validation set</span>
    <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_r</span><span class="p">,</span> <span class="n">y_train_c</span> <span class="o">=</span> <span class="n">prep_train_data</span><span class="p">(</span><span class="n">train_df</span><span class="p">,</span> <span class="n">input_cols</span><span class="p">)</span>
    
    <span class="c1"># prepare testing set</span>
    <span class="n">X_test</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="n">input_cols</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    
    <span class="n">model_r</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_r</span><span class="p">)</span>
    <span class="n">y_pred_train_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model_r</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">y_pred_test_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model_r</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">model_c</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train_c</span><span class="p">)</span>
    <span class="n">y_pred_train_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model_c</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">y_pred_test_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">model_c</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="n">y_pred_train_comb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y_pred_train_r</span> <span class="o">+</span> <span class="n">y_pred_train_c</span><span class="p">)</span>
    <span class="n">y_pred_train_comb</span><span class="p">[</span><span class="n">y_pred_train_comb</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">y_pred_test_comb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">y_pred_test_r</span> <span class="o">+</span> <span class="n">y_pred_test_c</span><span class="p">)</span>
    <span class="n">y_pred_test_comb</span><span class="p">[</span><span class="n">y_pred_test_comb</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">blend_train</span><span class="p">[:,</span> <span class="n">clf_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pred_train_comb</span>
    <span class="n">blend_test</span><span class="p">[:,</span> <span class="n">clf_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pred_test_comb</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Level 1 Belending Classifier using LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="n">bclf</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">(</span><span class="n">fit_intercept</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">bclf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">blend_train</span><span class="p">,</span> <span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>LinearRegression(copy_X=True, fit_intercept=False, n_jobs=1, normalize=False)
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># What is the weighted combination of the base classifiers?</span>
<span class="n">bclf</span><span class="o">.</span><span class="n">coef_</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>array([ 0.31355465,  0.73048534])
</pre></div>
</div>
<blockquote>
<div><p>We observe that the meta-learner LinearRegression has assigned weights 0.3 to the RandomForestRegressor and 0.7 to the GradientBoostingRegressor similar to the ones we did manually in the previous step.</p>
</div></blockquote>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Stacked and Blending predictions</span>
<span class="n">y_pred_blend</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">bclf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">blend_test</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># R^2 score</span>
<span class="n">bclf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">blend_train</span><span class="p">,</span> <span class="n">train_df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>0.96562432974162338
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># output predictions for submission</span>
<span class="n">submit_stack_blend_df</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[[</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">submit_stack_blend_df</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_pred_blend</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">submit_stack_blend_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<div>
<style>
    .dataframe thead tr:only-child th {
        text-align: right;
    }
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>.dataframe thead th {
    text-align: left;
}

.dataframe tbody tr th {
    vertical-align: top;
}
</pre></div>
</div>
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>datetime</th>
      <th>count</th>
    </tr>
    <tr>
      <th>datetime</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2011-01-20 00:00:00</th>
      <td>2011-01-20 00:00:00</td>
      <td>13.0</td>
    </tr>
    <tr>
      <th>2011-01-20 01:00:00</th>
      <td>2011-01-20 01:00:00</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>2011-01-20 02:00:00</th>
      <td>2011-01-20 02:00:00</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2011-01-20 03:00:00</th>
      <td>2011-01-20 03:00:00</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>2011-01-20 04:00:00</th>
      <td>2011-01-20 04:00:00</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">submit_stack_blend_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;output/submit_stack_blend.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>References:</strong></p>
<p>Blogs without which this notebook would not have been possible</p>
<ul class="simple">
<li><p>[1] <a class="reference external" href="https://www.analyticsvidhya.com/blog/2015/06/solution-kaggle-competition-bike-sharing-demand/">https://www.analyticsvidhya.com/blog/2015/06/solution-kaggle-competition-bike-sharing-demand/</a></p></li>
<li><p>[2]<a class="reference external" href="https://www.kaggle.com/benhamner/bike-rentals-by-time-and-temperature">https://www.kaggle.com/benhamner/bike-rentals-by-time-and-temperature</a></p></li>
<li><p>[3]<a class="reference external" href="https://github.com/logicalguess/kaggle-bike-sharing-demand">https://github.com/logicalguess/kaggle-bike-sharing-demand</a></p></li>
<li><p>[4]<a class="reference external" href="http://dataviztalk.blogspot.com/2016/02/how-to-add-jitter-to-plot-using-pythons.html">http://dataviztalk.blogspot.com/2016/02/how-to-add-jitter-to-plot-using-pythons.html</a></p></li>
<li><p>[5]<a class="reference external" href="https://www.kaggle.com/anuragreddy333/data-vizualization/code">https://www.kaggle.com/anuragreddy333/data-vizualization/code</a></p></li>
<li><p>[6][https://dnc1994.com/2016/05/rank-10-percent-in-first-kaggle-competition-en/]</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./machine-learning-with-python/kaggle-bike-sharing-demand"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        
    <a class='left-prev' id="prev-link" href="../breast-cancer-risk-prediction-classification/breast-cancer-risk-prediction-classification.html" title="previous page">Classification: Predict Diagnosis of a Breast Tumor as Malignant or Benign</a>
    <a class='right-next' id="next-link" href="../../data-science-with-spark/cluster-uber-trip-data/cluster-uber-trip-data.html" title="next page">Clustering Uber’s Trip Data with Apache Spark</a>

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Anindya Saha<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../../_static/js/index.js"></script>
    
  </body>
</html>